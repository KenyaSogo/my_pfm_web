<h1>Simulation Detail</h1>

<p>
  <strong>AssetName:</strong>
  <%= @simulation.asset.name %><br />
  <strong>SimulationName:</strong>
  <%= @simulation.name %><br />
  <strong>LastGeneratedAt:</strong>
  <%= display_datetime_string(@simulation.last_generated_at) %>
</p>

<p>
  <h2>SimulationSummary</h2>
  <table>
    <thead>
      <tr>
        <th>SummarizedAt</th>
        <th colspan="1">Actions</th>
      </tr>
    </thead>
    <tbody>
      <% if @simulation.simulation_summary.blank? %>
        <tr>
          <td>-</td>
          <td colspan="1">-</td>
        </tr>
      <% else %>
        <% simulation_summary = @simulation.simulation_summary %>
        <tr>
          <td><%= display_datetime_string(simulation_summary.summarized_at) %></td>
          <td><%= link_to 'Show', simulation_summary %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
  <br />
</p>

<p>
  <h2>SimulationEntries</h2>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>EntryType</th>
        <th>ApplyFrom</th>
        <th>ApplyTo</th>
        <th>EntryDetail_Counts</th>
        <th>ResultActivity_Counts</th>
        <th colspan="3">Actions</th>
      </tr>
    </thead>
    <tbody>
      <% if @simulation.simulation_entries.blank? %>
        <tr>
          <td>-</td>
          <td>-</td>
          <td>-</td>
          <td>-</td>
          <td>-</td>
          <td>-</td>
          <td colspan="3">-</td>
        </tr>
      <% else %>
        <% @simulation.simulation_entries.each do |simulation_entry| %>
          <tr>
            <td><%= simulation_entry.name %></td>
            <td><%= simulation_entry.simulation_entry_type&.name.presence || '-' %></td>
            <td><%= display_date_string(simulation_entry.apply_from) %></td>
            <td><%= display_date_string(simulation_entry.apply_to) %></td>
            <td><%= @entry_detail_counts_by_simulation_entry[simulation_entry.id].presence || 0 %></td>
            <td><%= @result_activity_counts_by_simulation_entry[simulation_entry.id].presence || 0 %></td>
            <td><%= link_to 'Show', simulation_entry %></td>
            <td><%= link_to 'Edit', edit_simulation_entry_path(simulation_entry) %></td>
            <td><%= link_to 'Destroy', simulation_entry, method: :delete, data: { confirm: 'Are you sure?' } %></td>
          </tr>
        <% end %>
      <% end %>
    </tbody>
  </table>
  <br />
  <%= link_to 'New SimulationEntry', new_simulation_entry_path(simulation_id: @simulation.id) %>
</p>

<p>
  <h2>BillingAccounts</h2>
  <table>
    <thead>
      <tr>
        <th>CreditAccountName</th>
        <th>BillingClosingDay</th>
        <th>WithdrawalDay</th>
        <th>BillingItemName</th>
        <th>BillingSubItemName</th>
        <th>DebitAccountName</th>
        <th>DebitItemName</th>
        <th>DebitSubItemName</th>
        <th>BillingActivity_Counts</th>
        <th colspan="3">Actions</th>
      </tr>
    </thead>
    <tbody>
      <% if @simulation.billing_accounts.blank? %>
        <tr>
          <td>-</td>
          <td>-</td>
          <td>-</td>
          <td>-</td>
          <td>-</td>
          <td>-</td>
          <td>-</td>
          <td>-</td>
          <td>-</td>
          <td colspan="3">-</td>
        </tr>
      <% else %>
        <% @simulation.billing_accounts.each do |billing_account| %>
          <tr>
            <td><%= billing_account.credit_account.name %></td>
            <td><%= billing_account.billing_closing_day %></td>
            <td><%= "#{billing_account.withdrawal_day}(#{withdrawal_month_offset_value(billing_account.withdrawal_month_offset)})" %></td>
            <td><%= billing_account.billing_item.name %></td>
            <td><%= billing_account.billing_sub_item.name %></td>
            <td><%= billing_account.debit_account.name %></td>
            <td><%= billing_account.debit_item.name %></td>
            <td><%= billing_account.debit_sub_item.name %></td>
            <td><%= @billing_activity_counts_by_billing_account[billing_account.id].presence || 0 %></td>
            <td><%= link_to 'Show', billing_account %></td>
            <td><%= link_to 'Edit', edit_billing_account_path(billing_account) %></td>
            <td><%= link_to 'Destroy', billing_account, method: :delete, data: { confirm: 'Are you sure?' } %></td>
          </tr>
        <% end %>
      <% end %>
    </tbody>
  </table>
  <br />
  <%= link_to 'New BillingAccount', new_billing_account_path(simulation_id: @simulation.id) %>
</p>

<%= link_to 'Edit', edit_simulation_path(@simulation) %> |
<%= link_to 'Back', @simulation.asset %>
